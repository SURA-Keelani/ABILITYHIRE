{% with messages = get_flashed_messages(with_categories=true) %} {% if messages
%} {% for category, message in messages %}
<div class="alert alert-{{ category }}">{{ message }}</div>
{% endfor %} {% endif %} {% endwith %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AbilityHire - Welcome</title>
  <style>
    input, select, textarea, button {
        font-size: calc(var(--global-font-size) - 4px);
    }
    :root {
      --light-bg: #f4f4f4;
      --dark-bg: #1c1c1c;
      --light-text: #111;
      --dark-text: #f0f0f0;
      --highlight: #005a9c;
      --lang-selected: #004080;
      --global-font-size: {{ global_font_size }}px;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: var(--global-font-size);
      background-color: var(--light-bg);
      color: var(--light-text);
      transition: background-color 0.3s, color 0.3s;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* RTL support */
    body.rtl {
      direction: rtl;
      text-align: right;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif, 'Arial', 'Helvetica', 'Tahoma', 'Times New Roman', 'Courier New', 'Droid Arabic Naskh', 'Amiri', 'Lateef', 'Scheherazade', 'Arabic Typesetting', 'Traditional Arabic', 'Simplified Arabic', 'Arial Unicode MS', 'Tahoma', 'Verdana', 'Segoe UI';
    }

    body.rtl header {
      flex-direction: row-reverse;
    }

    body.rtl .logo {
      margin-left: 0;
      margin-right: 10px;
    }

    body.rtl .nav-buttons button,
    body.rtl .lang-toggle button {
      margin-left: 0;
      margin-right: 1em;
    }

    body.rtl main {
      flex-direction: row-reverse;
    }

    body.rtl .welcome-text {
      margin-left: 0;
      margin-right: 2em;
      text-align: right;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5em 2em;
      background-color: var(--highlight);
      color: white;
      font-size: 1.1em;
    }

    .logo {
      display: flex;
      align-items: center;
      font-size: 1.5em;
      font-weight: bold;
    }

    .logo img {
      height: 40px;
      margin-right: 10px;
    }

    .nav-buttons button,
    .lang-toggle button {
      background: none;
      border: none;
      color: white;
      font-size: 1em;
      margin-left: 1em;
      cursor: pointer;
      padding: 0.3em 0.6em;
      border-radius: 5px;
    }

    .lang-toggle button.selected {
      background-color: var(--lang-selected);
    }

    .emoji-toggle {
      background: none;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      margin-left: 1em;
    }

    main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3em;
      flex-wrap: wrap;
      flex: 1;
    }

    .motivation-image img {
      width: 400px;
      max-width: 100%;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .welcome-text {
      flex: 1;
      margin-left: 2em;
      min-width: 300px;
    }

    .welcome-text h1 {
      font-size: 2.2em;
      margin-bottom: 0.5em;
      color: var(--highlight);
    }

    #welcomeMsg {
      font-size: 1.6em;
      font-weight: 600;
      line-height: 1.5;
      color: #5C85C1;
    }


    .scrolling-text {
      position: fixed;
      bottom: 0;
      width: 100%;
      white-space: nowrap;
      overflow: hidden;
      background-color: var(--highlight);
      color: white;
      font-size: 1.2em;
      padding: 0.5em;
    }

    .scrolling-text span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 20s linear infinite;
    }

    @keyframes scroll-left {
      0% { transform: translateX(0%); opacity: 1; }
      100% { transform: translateX(-100%); opacity: 0.3; }
    }

    .dark-mode {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }

    .dark-mode header {
      background-color: #2d2d2d;
    }

    .dark-mode .scrolling-text {
      background-color: #444;
    }
  </style>
  <script src="{{ url_for('static', filename='js/accessibility.js') }}"></script>
</head>
  <body>
    <header>
      {% include 'helpbar.html' %}
      <div class="logo">
<a href="{{ url_for('views.home') }}">
        <img src="{{ url_for('static', filename='images/abilityhire_logo.png') }}" alt="AbilityHire Logo">
      </a>
      <span id="brandName"></span>
    </div>
    <div class="nav-buttons">
      <button onclick="navigateTo('/about')" id="aboutBtn"></button>
      <button onclick="navigateTo('/login')" id="signinBtn"></button>
      <button onclick="navigateTo('/signup')" id="signupBtn"></button>
      <button onclick="navigateTo('/forget_password')" id="forgetPasswordBtn">Forget Password</button>
      <a href="{{ url_for('views.favorites') }}" id="favoritesBtn" style="color: white; text-decoration: none; font-size: 1.2em;">‚ù§Ô∏è</a>
      <button onclick="navigateTo('/accessibility_map_v2')" id="accessibilityMapBtn">Accessibility Map</button>

      <!-- Notification Icon -->
      <button id="notificationBtn" style="position: relative; background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; margin-left: 1em;" onclick="navigateTo('{{ url_for('views.notifications') }}')">
        üîî
        <span id="notificationBadge" style="position: absolute; top: -5px; right: -5px; background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.75em; display: none;">0</span>
      </button>

      <span class="lang-toggle">
        <button class="lang-btn" data-lang="en" onclick="setLanguage('en')">English</button>
        <button class="lang-btn" data-lang="ar" onclick="setLanguage('ar')">ÿπÿ±ÿ®Ÿä</button>
      </span>
      <button class="emoji-toggle" onclick="toggleMode()">üåì</button>
    </div>
  </header>

  {% block content %}{% endblock %}

  <script>
    // Poll for unread notifications count every 30 seconds
    function fetchNotificationCount() {
      fetch('/notifications/count')
        .then(response => response.json())
        .then(data => {
          const badge = document.getElementById('notificationBadge');
          if (data.unread_count > 0) {
            badge.textContent = data.unread_count;
            badge.style.display = 'inline-block';
          } else {
            badge.style.display = 'none';
          }
        })
        .catch(err => console.error('Error fetching notification count:', err));
    }

    // Initial fetch and interval setup
    fetchNotificationCount();
    setInterval(fetchNotificationCount, 30000);

    // Toggle notification dropdown
    const notificationBtn = document.getElementById('notificationBtn');
    const notificationDropdown = document.getElementById('notificationDropdown');
    const notificationList = document.getElementById('notificationList');
    const markAllReadBtn = document.getElementById('markAllReadBtn');

    notificationBtn.addEventListener('click', () => {
      if (notificationDropdown.style.display === 'none') {
        notificationDropdown.style.display = 'block';
        loadNotifications();
      } else {
        notificationDropdown.style.display = 'none';
      }
    });

    // Load notifications via AJAX
    function loadNotifications() {
      fetch('/notifications')
        .then(response => {
          if (response.redirected) {
            // If redirected to login, show message
            notificationList.innerHTML = '<li>Please log in to view notifications.</li>';
            return null;
          }
          return response.text();
        })
        .then(html => {
          if (html) {
            // Parse the returned HTML and extract notification list items
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const items = doc.querySelectorAll('#notifications-list ul li');
            if (items.length > 0) {
              notificationList.innerHTML = '';
              items.forEach(item => {
                notificationList.appendChild(item);
              });
            } else {
              notificationList.innerHTML = '<li>No notifications.</li>';
            }
          }
        })
        .catch(err => {
          notificationList.innerHTML = '<li>Error loading notifications.</li>';
          console.error('Error loading notifications:', err);
        });
    }

    // Mark all as read
    markAllReadBtn.addEventListener('click', () => {
      fetch('/notifications/mark_all_read', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            fetchNotificationCount();
            loadNotifications();
          }
        });
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
      if (!notificationBtn.contains(event.target) && !notificationDropdown.contains(event.target)) {
        notificationDropdown.style.display = 'none';
      }
    });
  </script>

  <main>
    <div class="motivation-image">
      <img src="{{ url_for('static', filename='images/Home Page.png') }}" alt="Diverse team working together">
    </div>
    <div class="welcome-text">
      <h1 id="welcomeTitle">Welcome to AbilityHire</h1>
      <p id="welcomeMsg">
        Dedicated to connecting individuals with disabilities to inclusive job opportunities.
        Join us in building a workforce where everyone belongs and thrives.
      </p>
    </div>
  </main>

  <div class="scrolling-text">
    <span id="scrollQuotes">
       We believe in abilities... not in obstacles
      Believe in yourself and all that you are. ‚Äî Every challenge is an opportunity to grow. ‚Äî Your potential is endless. ‚Äî Together, we build a more inclusive future.
    </span>
  </div>

    <script>
      let currentLang = localStorage.getItem('abilityHireLang') || 'en';
      let currentMode = localStorage.getItem('abilityHireMode') || 'light';

      function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('abilityHireLang', lang);
        applyLanguage();
      }

      function toggleMode() {
        document.body.classList.toggle("dark-mode");
        currentMode = document.body.classList.contains("dark-mode") ? "dark" : "light";
        localStorage.setItem('abilityHireMode', currentMode);
      }

      function navigateTo(page) {
        window.location.href = `${page}?lang=${currentLang}&mode=${currentMode}`;
      }

      function applyLanguage() {
        document.body.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.toggle('selected', btn.dataset.lang === currentLang);
        });

        const translations = {
          en: {
            welcomeTitle: "Welcome to AbilityHire",
            welcomeMsg: "Dedicated to connecting individuals with disabilities to inclusive job opportunities. Join us in building a workforce where everyone belongs and thrives.",
            scrollQuotes: "We believe in abilities... not in obstacles. ‚Äî Believe in yourself and all that you are. ‚Äî Every challenge is an opportunity to grow. ‚Äî Your potential is endless. ‚Äî Together, we build a more inclusive future.",
            aboutBtn: "About",
            signinBtn: "Sign In",
            signupBtn: "Sign Up",
            accessibilityMapBtn:"Accessibility Map",
            forgetPasswordBtn:"Forget Password"

          },
          ar: {
            welcomeTitle: "ÿ£ŸáŸÑÿßŸã ÿ®ŸÉ ŸÅŸä AbilityHire",
            welcomeMsg: "ŸÖŸàŸÇÿπ ŸÖÿÆÿµÿµ ŸÑÿ±ÿ®ÿ∑ ÿ∞ŸàŸä ÿßŸÑÿ•ÿπÿßŸÇÿ© ÿ®ŸÅÿ±ÿµ ÿπŸÖŸÑ ÿ¥ÿßŸÖŸÑÿ©. ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸäŸÜÿß ŸÑÿ®ŸÜÿßÿ° ŸÇŸàÿ© ÿπÿßŸÖŸÑÿ© ÿ≠Ÿäÿ´ Ÿäÿ¥ÿπÿ± ÿßŸÑÿ¨ŸÖŸäÿπ ÿ®ÿßŸÑÿßŸÜÿ™ŸÖÿßÿ° ŸàÿßŸÑŸÜÿ¨ÿßÿ≠.",
            scrollQuotes: "...ÿ¢ŸÖŸÜ ÿ®ŸÜŸÅÿ≥ŸÉ Ÿàÿ®ŸÉŸÑ ŸÖÿß ÿ£ŸÜÿ™ ÿπŸÑŸäŸá ‚Äî ŸÉŸÑ ÿ™ÿ≠ÿØ ŸáŸà ŸÅÿ±ÿµÿ© ŸÑŸÑŸÜŸÖŸà. ‚Äî ÿ•ŸÖŸÉÿßŸÜŸäÿßÿ™ŸÉ ŸÑÿß ÿ≠ÿØŸàÿØ ŸÑŸáÿß. ‚Äî ŸÖÿπŸãÿß ŸÜÿ®ŸÜŸä ŸÖÿ≥ÿ™ŸÇÿ®ŸÑŸãÿß ÿ£ŸÉÿ´ÿ± ÿ¥ŸÖŸàŸÑŸãÿß. ‚Äî ŸÜÿ§ŸÖŸÜ ÿ®ÿßŸÑŸÇÿØÿ±ÿßÿ™... ŸÑÿß ÿ®ÿßŸÑÿπŸÇÿ®ÿßÿ™",
            aboutBtn: "ÿ≠ŸàŸÑ",
            signinBtn: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
            signupBtn: "ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®",
            accessibilityMapBtn:"ÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑŸàÿµŸàŸÑ ",
            forgetPasswordBtn:"ŸáŸÑ ŸÜÿ≥Ÿäÿ™ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" 
          }
        };

        const t = translations[currentLang];
        Object.keys(t).forEach(key => {
          const element = document.getElementById(key);
          if (element) element.textContent = t[key];
        });
      }

      window.addEventListener('DOMContentLoaded', function() {
        const urlLang = localStorage.getItem('abilityHireLang') || 'en';
        const urlMode = localStorage.getItem('abilityHireMode') || 'light';

        if (urlLang) {
          currentLang = urlLang;
          localStorage.setItem('abilityHireLang', currentLang);
        }
        if (urlMode) {
          currentMode = urlMode;
          localStorage.setItem('abilityHireMode', currentMode);
        }
        if (currentMode === 'dark') document.body.classList.add('dark-mode');

        applyLanguage();
      });
  </script>

  <script>
    // Poll for unread notifications count every 30 seconds
    function fetchNotificationCount() {
      fetch('/notifications/count')
        .then(response => response.json())
        .then(data => {
          const badge = document.getElementById('notificationBadge');
          if (data.unread_count > 0) {
            badge.textContent = data.unread_count;
            badge.style.display = 'inline-block';
          } else {
            badge.style.display = 'none';
          }
        })
        .catch(err => console.error('Error fetching notification count:', err));
    }

    // Initial fetch and interval setup
    fetchNotificationCount();
    setInterval(fetchNotificationCount, 30000);
  </script>
</body>
</html>
